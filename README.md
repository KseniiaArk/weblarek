# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

В коде используются следующие интерфейсы и типы для описания данных:

#### Товар (IProduct) описывает структуру товара в каталоге магазина

interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    price: number | null;
    category: ProductCategory;
}

#### Покупатель (IBuyer) описывает данные покупателя, необходимые для оформления заказа

interface IBuyer {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
}

#### Ответы API

interface IItemListResponse {
    total: number;
    items: IProduct[];
}

interface IOrderResponse {
    id: string;
    total: number;
}

type IOrderRequest = IBuyer & {
    items: string[];
    total: number;
}

### Модели данных

#### Класс Product - каталог товаров.

Отвечает за хранение и управление каталогом товаров. Хранит список товаров, а также выбранный товар для детального просмотра.

Конструктор `constructor()` не принимает параметров, инициализирует пустой массив товаров и null для выбранного.

Поля класса:

`private _items: IProduct[]` - массив всех товаров в каталоге.
`private _selectedItem: IProduct | null` - товар, выбранный для подробного отображения.

`setItems(items: IProduct[]): void` - сохраняет массив товаров в модели.
`getItems(): IProduct[]` - получает массив товаров из модели.
`getItem(id: string): IProduct | null` - получает товар по его ID.
`setSelectedItem(item: IProduct | null): void` - сохраняет товар для подробного отображения.
`getSelectedItem(): IProduct | null` - получает товар для подробного отображения.

#### Класс Basket - корзина

Управляет выбранными покупателем товарами. Реализует добавление, удаление и расчет общей стоимости товаров в корзине.

Конструктор `constructor()` инициализирует пустой массив товаров в корзине.

Поля класса:

`private _items: IProduct[]` - массив товаров в корзине.

Методы класса:

`getBasketItems(): IProduct[]` - получает товары из корзины.
`addItem(item: IProduct | null): void` - добавляет товар в корзину, если он еще не в ней.
`removeItem(item?: IProduct | null): void` - удаляет выбранный товар из корзины.
`clearItems(): void` - очищает корзину.
`getTotalPrice(): number` - рассчитывает полную стоимость корзины.
`getItemsAmount(): number` - рассчитывает количество товаров в корзине.
`inBasket(id: string): boolean` - проверяет наличие товара в корзине по ID.

#### Класс Customer - покупатель

Хранит и управляет данными покупателя. Реализует валидация введенных данных.

Конструктор `constructor()` инициализирует все поля пустыми значениями.

Поля класса:

`private _payment: TPayment` - способ оплаты.
`private _email: string` - email.
`private _phone: string` - номер телефона.
`private _address: string` - адрес доставки.

Методы класса:

`setCustomerInfo(data: Partial<IBuyer>): void` - сохраняет данные, обновляя отдельные поля, не удаляя их.
`getCustomerInfo(): IBuyer` - получает сохраненные данные.
`clearCustomerInfo(): void` - очищает данные пользователя.
`validationCustomerInfo(): Record<string, string>` - проверяет валидность, введенных полей покупателя.

### Слой коммуникации

#### Класс ApiService - сервис API

Отвечает за обмен данными с сервером. Получает информацию о товарах и отправляет данные о новых заказах.

Конструктор `constructor(private api: IApi)` принимает параметр `api`. Объект `api` реализует интерфейс `IApi`.

Методы класса:

`getItemsList(): Promise<IItemListResponse>` - получает каталог товаров с сервера.
`postOrder(evt: IOrderRequest): Promise<IOrderResponse>` - отправляет заказ на сервер для обработки.

### Слой представления

Для корректного отображения сайта были реализованы классы HeaderView, GalleryView, ModalView,
BasketView, SuccessView, MainCard, CardCatalog, CardPreview, CardBasket, MainForm, OrderForm, ContactForm.

#### HeaderView - класс отображения заголовка, который содержит корзину.

Конструктор `constructor(conteiner: HTMLElement, protected evt: IEvents)` получает контейнер и систему событий, находит DOM-элементы, устанавливает обработчик клика на кнопку корзины.

Поля класса:

`protected counterElement: HTMLElement` - отображение количества товаров в корзине

`protected basketButton: HTMLButtonElement` - кнопка для открытия корзины

Метод класса:

`set counter(value: number)` - обновляет количество товаров в корзине.

#### GalleryView - отображение галереи.

Отвечает за отображение каталога элементов на странице. 

Конструктор `constructor(container: HTMLElement)` принимает параметр `container`. `container` является DOM-элементов, в котором размещается галерея.

Поля класса:

`catalogElement: HTMLElement` - контейнер для элементов галереи, найденный по селектору `'.gallery'`

Метод класса:

`set catalog(items: HTMLElement[])` - обновляет галерею, заменяя текущие элементы на переданный массив DOM-элементов

#### ModalView - отображение модального окна

Реализует открытие, закрытие и взаимодействие с модальным окном.

Конструктор `constructor(container: HTMLElement, private evt: IEvents)` принимает параметры `container` (DOM-элемент модального окна) и `evt` (реализует интерфейс событий `IEvent`). 

Поля класса:

`isOpen = false` - флаг состояния модального окна

`pageWrapper: HTMLElement` - контейнер страницы для управления блокировкой прокрутки

`closeButton: HTMLButtonElement` - кнопка закрытия модального окна

`modalContent: HTMLElement` - контейнер содержимого модального окна

Методы класса:

`setContent(content: HTMLElement): void` - устанавливает содержимое модального окна

`open(): void` - открывает модальное окно и эмитит событие `'modal:open'`

`close(): void` - закрывает модальное окно и эмитит событие `'modal:close'`

`isModalOpen(): boolean` - возвращает текущее состояние модального окна

`toggleModal(open: boolean): void` - переключает видимость модального окна и блокировку страницы

`handleOverlayClick(evt: Event): void` - обрабатывает клик по overlay для закрытию

`handleKeydown(evt: KeyboardEvent): void` - обрабатываеи нажатие Escape для закрытия

#### BasketView - отображение корзины покупок

Отвечает за отображение и управление интерфейсом корзины. Отображает список добавленных товаров, общую стоимость и функционал для оформления заказа.

Конструктор `constructor(container: HTMLElement, evt?: IBuy)` принимает параметры `container` и `evt`. Объект `container` является DOM-элементом корзины, `evt` реализует интерфейс покупки `IBuy` для обработки события оформления заказа.

Поля класса:

`title: HTMLElement` - заголовок модального окна корзины

`list: HTMLElement` - контейнер для списка товаров в корзине

`button: HTMLButtonElement` - кнопка оформления заказа

`price: HTMLElement` - элемент отображения общей стоимости

Методы класса:

`set items(value: HTMLElement[])` - устанавливает список товаров в корзине, обрабатывает пустое состояние

`set buttonText(value: string)` - устанавливает текст кнопки оформления заказа

`set buttonDisabled(value: boolean)` - устанавливает состояние кнопки

`set total(value: number)` - устанавливает общую стоимость товаров в корзине

#### SuccessView - отображение успешного заказа

Реализует отображение модального окна успешного завершения заказа с указанием суммы и кнопкой закрытия уведомления.

Конструктор `constructor(container: HTMLElement, evt?: ISuccession)` принимает параметры `container` и `evt`. `container` является DOM-элементом уведомления об успехе, `evt` реализует интерфейс `ISuccess` для обработки закрытия уведомления.

Поля класса:

`description: HTMLElement` - элемент представления описания с информацией о списанной сумме

`button: HTMLButtonElement` - кнопка закрытия уведомления

Методы класса:

`set total(sum: number)` - устанавливает отображаемую сумму списания

#### MainCard - абстрактное представление карточки товара

Отвечает за базовое отображение карточки товара. Определяеи общую структуру и функциональность для всех типов карточек товаров, включая отображение названия и цены.

Конструктор `constructor(container: HTMLElement)` принимает параметр `container`, который является DOM-элементом карточки товара.

Поля класса:

`cardTitle: HTMLElement` - элемент для отображения названия товара

`cardPrice: HTMLElement` - элемент для отображения цены товара

Методы класса:

`set title(value: string)` - устанавливает название товара

`set price(value: number | null)` - устанавливает цену товара с обработкой случая "бесценно"

#### CardCatalog - представление карточки товара в каталоге

Отвечает за отображение карточки в каталоге. Расширяет MainCard, добавляя изображение товара, категорию и обработку кликов для выбора карточки.

Конструктор `constructor(container: HTMLElement, evt?: ICatalogClick)` принимает `container` и `evt`. Объект `container` является DOM-элементов карточки, `evt` реализует интерфейс `ICatalogClick` для обработки клика на карточку.

Поля класса:

`cardImage: HTMLImageElement` - элемент для отображения картинки товара

`cardCategory: HTMLElement` - элемент для отображения категории товара

Методы класса:

`set image(value: string)` - устанавливает изображение товара

`set category(value: string)` - устанавливает категорию товара 

#### CardPreview - представление карточки товара в превью

Отвечает за отображение детализированной карточки товара в режиме предпросмотра. Расширяет MainCard, добавляя описание товара, кнопку действия и описание товара.

Поля класса:

`cardImage: HTMLImageElement` - элемент для отображения изображения товара

`cardCategory: HTMLElement` - элемент для отображения категории товара

`cardText: HTMLElement` - элемент для отображения описания товара

`cardButton: HTMLButtonElement` - кнопка добавления/удаления из корзины

Методы класса:

`set image(value: string)` - устанавливает изображение товара

`set category(value: string)` - устанавливает категорию товара 

`set description(value: string)` - устанавливает текстовое описание товара

`set buttonText(value: string)` - устанавливает текст на кнопке действия

`set buttonLocked(value: boolean)` - управляет состоянием кнопки 

#### CardBasket - представление карточки товара в  корзине

Реализует отображение карточки товара в интерфейсе корзины покупок. Расширяет MainCard, добавляет порядковый номер товара и кнопку удаления из корзины.

Конструктор `constructor(container: HTMLElement, evt?: IDeleteFromBasket)` принимает параметры `container` и `evt`. Объект `container` является DOM-элементов карточки товара в корзине, `evt` реализует интерфейс `IDeleteFromBasket` для обработки события удаления товара из корзины.

Поля класса:

`itemIndex: HTMLElement` - элемент для отображения индекса товара в корзине

`itemDelete: HTMLButtonElement` - кнопка для удаления товара из корзины

Методы класса:

`set index(value: number)` - устанавливает индекс товара в корзине

#### MainForm - абстрактное представленние формы

Отвечает за базовую функциональность форм, включая валидацию, отображение ошибок и управление состоянием кнопки отправки. Определяет общую структуру и поведение для всех типов форм в приложении.

Конструктор `constructor(container: HTMLElement, evt?: IFormSubmit)` принимает параметры  `container` и `evt`. Объект `container` является DOM-элементом формы, `evt` реализует интерфейс `IFormSubmit` для обработки события отправки формы.

Поля класса:

`formSubmit: HTMLButtonElement` - кнопка отправки формы

`formError: HTMLElement` - элемент для отображения ошибок валидации

Методы класса:

`set valid(isValid: boolean)` - управляет состоянием кнопки отправки

`set errorText(text: string)` - устанавливает текст ошибки валидации

`clearErrors(): void` - очищает текст ошибок валидации

`setValidationError(er: Record<string, string>): void` - обрабатывает и отображает ошибки валидации 

`extractErrorMessages(er: Record<string, string>): string[]` - извлекает сообщение об ошибках из объекта валидации

`hasErrors(message: string[]): boolean` - проверяет наличие ошибок валидации

`displayErrors(message: string[]): void` - отображает сообщени об ошибках в интерфейсе

#### OrderForm - представление формы заказа

Отвечает за управление формой оформления заказа, включающей способ оплаты и адрес доставки. Расширяет MainForm, добавляя специализированные элементы для процесса заказа.

Конструктор `constructor(container: HTMLElement, callbacks?: IOrderFormCallbacks)` примает параметры `container` и `callbacks`. Объект `container` является DOM-элементом формы заказа, `callbacks` реализует интерфейс `IOrderFormCallbacks` для обработки событий отправки формы, изменения способа оплаты и доставки.

Поля класса:

`payButtons: HTMLButtonElement[]` - массив кнопок выбора способа оплаты

`addressForm: HTMLInputElement` - поле ввода адреса доставки

`chosenPay: TPayment = ''` - выбранный способ оплаты

Методы класса:

`set payment(value: TPayment)` - устанавливает способ оплаты и обновляет состояние кнопок

`get payment(): TPayment` - возвращает способ оплаты

`set address(value: string)` - устанавливает значение адреса доставки

`get address(): string` - возвращает введенный адрес доставки

`chosenPaymentType(payment: TPayment): void` - обновляет визуальное выделение выбранного способа оплаты

`get itemsOrderData(): Pick<IBuyer, 'payment' | 'address'>` - возвращает данные заказа для отправки на сервер

#### ContactForm - представление формы контактов

Отвечает за управление формой ввода контактных данных покупателя, включая телефон и email. Расширяет MainForm, добавляя специализированные поля для контактной информации.

Конструктор `constructor(container: HTMLElement, evt?: IOrderContactCallbacks)` принимает `container` и `evt`. Объект `container` является DOM-элементом формы контактов, `evt` реализует интерфейс `IOrderContactCallbacks` для обработки событий отправки форму, изменения телефона и электронной почты.

Поля класса:

`phoneInp: HTMLInputElement` - поле ввода номера телефона

`emailInp: HTMLInputElement` - поле ввода электронной почты

Методы класса:

`setupPhoneCallback(onPhoneChange?: (phone: string) => void): void` - настраивает обработчик изменения поля телефона

`setupEmailCallback(onEmailChange?: (email: string) => void): void` - настраивает обработчик изменения поля email

`set phone(value: string)` - устанавливает значение номера телефона

`get phone(): string` - возвращает введенный номер телефона

`set email(value: string)` - устанавливает адрес электронной почты

`get email(): string` - возвращает введенный адрес электронной почты

`get itemsContactData(): Pick<IBuyer, 'email' | 'phone'>` - возвращает контактные данные для отправки на сервер

#### Слой презентера

Инкапсулирует основную логику приложения, инициализируя все компоненты и управляя их совместной работой. Координирует обмен данными между моделями, представлениями и внешними сервисами. Обрабатывает бизнес-логику и пользовательские взаимодействия.

##### Обработчик событий

##### События взаимодействия с товарами

`card:selected` - открывает превью товара в модальном окне. Автоматически определяет состояние кнопки (добавить/удалить) на основе наличия товара в корзине.

`card:add` - добавляет товар в модель корзины. Вызывает событие basket:changed для обновления UI.

`card:remove`- удаляет товар из модели корзины. Вызывает событие basket:changed для обновления UI.

##### События работы с корзиной

`basket:open` - открывает модальное окно корзины. Динамически рендерит содержимое корзины с нумерацией позиций.

`basket:changed` - обновляет счетчик товаров в хедере. При открытом модальном окне корзины перерисовывает ее содержимое.

`basket:order` - открывает форму оформления заказа (данные доставки). Восстанавливает ранее введенные данные пользователя.

##### События оформления заказа

`order:submit` - валидирует данные доставки. При успешной валидации сохраняет данные и открывает форму контактов.

`contacts:submit` - собирает полные данные заказа и отправляет на сервер. При успехе показывает страницу подтверждения.

`buyer:changed` - обновляет валидацию открытых форм в реальном времени на основе изменений данных пользователя.

##### События модальных окон

`modal:close` - Сбрасывает временные состояния форм заказа. Очищает ссылки на текущие формы.

`catalog:changed` - перерисовывает галерею товаров при изменении каталога. Создает карточки товаров с обработчиками выбора.


